<?xml version="1.0"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="common">
    
    <!-- -->
    <property file="${common.dir}/common.properties"/>
    <!-- <import file="ivyinstall.xml"/> -->
    
    <!-- -->
    <path id="lib.path.id">
        <fileset dir="${lib.dir}"/>
    </path>
    
    <!-- -->
    <path id="run.path.id">
        <path refid="lib.path.id"/>
        <path location="${classes.dir}"/>
    </path>
    
    <!-- -->
    <target name="load-ivy">
        
        <mkdir dir="${ivy.jar.dir}"/>
        
        <copy file="${ivy.install.jar.file}" 
            tofile="${ivy.jar.file}" 
            overwrite="false"/>
            
        <path id="ivy.lib.path">
            <fileset dir="${ivy.jar.dir}" includes="*.jar"/>
        </path>
        <taskdef resource="org/apache/ivy/ant/antlib.xml" 
            uri="antlib:org.apache.ivy.ant" classpathref="ivy.lib.path"/>
    </target>
    
    <!-- -->
    <target name="configure" depends="load-ivy">
        <echo message="${ivy.settings.file}"/>
       	<ivy:settings/>
    </target>
    
    <!-- -->
    <target name="resolve" depends="clean-lib, load-ivy">
        <mkdir dir="${lib.dir}"/>
        <ivy:resolve file="${ivy.file}"/>
        <!--<ivy:retrieve/>-->
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[revision].[ext]"/>
    </target>
    
    <!-- -->
    <target name="report" depends="resolve">
        <ivy:report todir="${build.dir}"/>
    </target>
    
    <!-- -->
    <target name="compile" depends="resolve">
        <echo message="Compiling ${src.dir}"/>
        <mkdir dir="${classes.dir}" />
        <javac 
            srcdir="${src.dir}" 
			destdir="${classes.dir}" 
			debug="${compile.debug}"
			optimize="${compile.optimize}" 
			source="${compile.source}"
			target="${compile.target}"
			deprecation="${compile.deprecation}"
			encoding="${compile.encoding}"
			classpathref="lib.path.id"/>
    </target>
    
    <!-- -->
    <target name="clean-local" depends="load-ivy">
		<ivy:info file="${ivy.file}" />
	   <delete dir="${ivy.local.default.root}/${ivy.organisation}/${ivy.module}"/>
	</target>
	
	<!-- -->
    <target name="clean-lib">
        <delete includeemptydirs="true" dir="${lib.dir}"/>
    </target>

    <!-- -->
    <target name="clean-build">
        <delete includeemptydirs="true" dir="${build.dir}"/>
    </target>

    <!-- -->
    <target name="clean" depends="clean-build, clean-lib"/>
</project>
